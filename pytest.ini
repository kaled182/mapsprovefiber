[pytest]

# =============================================================================
# CONFIGURAÇÃO BASE DO PYTEST
# =============================================================================

DJANGO_SETTINGS_MODULE = settings.test

# Opções de execução padrão
addopts =
    -v                  # Verbose output
    --tb=short          # Traceback curto
    --strict-markers    # Exige markers declarados
    --strict-config     # Exige configuração válida
    -x                  # Para no primeiro erro
    --disable-warnings  # Remove warnings do output
    --durations=10      # Mostra 10 testes mais lentos
    -ra                 # Mostra resumo de falhas

# Avisos a ignorar
filterwarnings =
    ignore::DeprecationWarning
    ignore::UserWarning
    ignore::PendingDeprecationWarning

# =============================================================================
# MARKERS (CATEGORIAS DE TESTE)
# =============================================================================

markers =
    slow: testes lentos (executar com --slow ou -m "slow")
    integration: testes de integração (requer serviços externos)
    unit: testes unitários (isolados e rápidos)
    db: testes que usam banco de dados
    celery: testes de tarefas Celery
    zabbix: testes da integração Zabbix
    maps: testes de mapas/geolocalização
    api: testes de API REST
    auth: testes de autenticação/autorização
    security: testes de segurança
    views: testes de views Django
    models: testes de models Django
    forms: testes de forms Django
    middleware: testes de middleware

# =============================================================================
# DESCOBERTA DE TESTES
# =============================================================================

testpaths =
    tests
    core/tests
    maps_view/tests
    routes_builder/tests
    setup_app/tests
    zabbix_api/tests

python_files =
    test_*.py
    *_test.py
    *_tests.py

python_classes =
    Test*
    *Test

python_functions =
    test_*

# Diretórios ignorados
norecursedirs =
    .git
    .pytest_cache
    __pycache__
    *.egg-info
    build
    dist
    node_modules
    .venv
    venv
    media
    staticfiles

# =============================================================================
# LOG CLI (opcional)
# =============================================================================

log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

